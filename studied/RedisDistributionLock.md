## 레디스 활용하여 동시성 문제 해결하기

**Lettuce**
- `setnx` 명령어를 활용하여 분산락 구현
  - setnx (set if not exist)
  - key와 value가 set할때 기존에 값이 없을때만 set한다.
- spin lock 방식이다.
  - 스레드가 락을 획득할 수 있는지 반복적으로 확인하면서 락을 획득하는 방식.
  - 재시도 로직을 개발자가 작성해줘야 한다.

**Redisson**
- pub-sub 기반으로 락 구현 제공
  - 채널을 사용.
  - 락을 점유중인 스레드가 채널을 통해서 대기중인 스레드에게 해제를 알려주면 안내를 받은 스레드가 락을 획득하는 방식.

## Lettuce 방식

**장점**
- 구현이 간단하다.
- spring data redis를 사용하면 lettuce가 기본값이기 때문에 별도의 라이브러리를 사용하지 않아도 된다.

**단점**
- spin lock 방식이기 때문에 동시에 많은 스레드가 lock 획득 대기 상태라면 레디스에 부하를 줄 수 있다.

## Redisson 방식

자신이 점유하고 있는 락을 해제할때 체널에 메시지를 보내줌으로서 락 획득을 대기하고있는 스레드들에게 락을 획득할 것을 알리는 알림을 전달해준다.

**장점**
- 락 획득 재시도를 기본으로 제공한다.
- pub-sub 방식으로 락 해제가 되었을때 한두번만 시도를 하기 때문에 Lettuce 방식에 비해서 레디스에 부하가 적다.

**단점**
- 구현이 복잡하다.
- 별도의 라이브러리를 사용해야한다.
